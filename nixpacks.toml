[variables]
NODE_VERSION = "20"
# Disable Next.js telemetry for faster builds
NEXT_TELEMETRY_DISABLED = "1"
# Use production node env
NODE_ENV = "production"
# Enable build cache
BUILDKIT_CACHE_MOUNT_NS = "railway"

[phases.setup]
nixPkgs = ["nodejs-20_x"]

[phases.install]
cmds = ["npm ci --prefer-offline --no-audit --include=dev"]

[phases.build]
# Ensure Prisma Client is generated before TypeScript compilation
# Run prisma generate explicitly to ensure types are available
cmds = ["npx prisma generate", "npm run build"]

[start]
# Use start script that runs migrations before starting
cmd = "sh scripts/start.sh"


